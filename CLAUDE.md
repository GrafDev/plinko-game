# CLAUDE.md

Этот файл содержит руководство для Claude Code (claude.ai/code) при работе с кодом в этом репозитории.

## Общие инструкции

**ВАЖНО**: Все ответы в чате должны быть написаны на русском языке. Объяснения кода, комментарии и документация также должны быть на русском языке.

## Обзор проекта

Это игра Plinko (азартная игра) построенная на vanilla JavaScript и физическом движке Matter.js. В игре представлена пирамида из колышков, где шарики падают и отскакивают в корзины с множителями. Используется Vite для разработки и сборки.

## Команды для разработки

### Основные команды
- `npm run dev` - Запустить сервер разработки с горячей перезагрузкой
- `npm run build` - Собрать для продакшена
- `npm run preview` - Предварительный просмотр продакшн сборки локально

### Структура проекта
```
assets/
├── css/          # Стили (модульные CSS файлы)
├── images/       # Игровые ресурсы и логотипы
└── js/           # JavaScript модули
    ├── index.js          # Точка входа и инициализация игры
    ├── PlinkoGame.js     # Основной класс игры и оркестрация
    ├── config.js         # Конфигурация игры и адаптивные размеры
    ├── GameLogic.js      # Состояние игры, ставки и логика выигрышей
    ├── PhysicsManager.js # Физика Matter.js и управление шариками
    ├── PyramidManager.js # Размещение колышков и создание пирамиды
    ├── BinsManager.js    # Корзины с множителями внизу
    ├── UIManager.js      # Игровые элементы управления и интерфейс
    ├── PathManager.js    # Планирование траектории шариков
    ├── PathRenderer.js   # Визуализация пути шариков
    └── WinModalManager.js # Модальные окна уведомлений о выигрыше
```

## Ключевые архитектурные концепции

### Поток инициализации игры
1. `index.js` инициализирует игру после готовности DOM
2. Класс `PlinkoGame` управляет всеми менеджерами и обрабатывает адаптивный дизайн
3. Менеджеры инициализируются в определенном порядке: PyramidManager → BinsManager → PathManager → PhysicsManager → UIManager → GameLogic

### Интеграция физического движка
- Использует Matter.js для реалистичной физики шариков и обнаружения столкновений
- `PhysicsManager` обрабатывает создание шариков, движение и проверку границ
- `PyramidManager` создает физические тела колышков с настраиваемыми свойствами
- Все физические тела добавляются в общий мир Matter.js

### Система адаптивного дизайна
- `config.js` содержит логику адаптивного размера на основе размеров экрана
- `updateSizesBasedOnRows()` пересчитывает размеры колышков/шариков для разных размеров экрана
- Игра обрабатывает изменения ориентации и события изменения размера окна
- Использует масштабирование на основе коэффициентов для постоянного внешнего вида на разных устройствах

### Паттерн менеджеров
Каждый менеджер обрабатывает определенный аспект игры:
- **PyramidManager**: Размещение колышков, обнаружение столкновений, визуальные эффекты
- **BinsManager**: Нижние корзины, значения множителей, анимации выигрышей
- **PathManager**: Расчет траектории и предсказание пути шариков
- **PhysicsManager**: Физика шариков, обработка столкновений, очистка
- **UIManager**: Элементы управления, отображение баланса, интерфейс ставок
- **GameLogic**: Состояние игры, обработка ставок, расчеты выигрышей

### Система пути шариков
- `PathManager` рассчитывает теоретические пути шариков через пирамиду колышков
- `PathRenderer` предоставляет визуальную обратную связь, показывая возможные траектории шариков
- Использует расчеты отскоков на основе вероятности для предсказания вероятных исходов

## Система конфигурации

Игра использует сложную систему конфигурации в `config.js`:
- Базовая конфигурация со значениями по умолчанию
- Адаптивные размеры на основе размеров экрана и количества рядов
- Динамический пересчет для адаптивного дизайна
- Настраиваемые параметры физики, цвета и игровые настройки

## Заметки по разработке

### Интеграция Matter.js
- Движок работает с настраиваемыми параметрами гравитации и времени
- Физические тела имеют определенные значения упругости и трения
- Обнаружение столкновений запускает события игровой логики

### Система событий
- Пользовательская система событий в `GameLogic` для изменений состояния игры
- События Matter.js для физических взаимодействий
- DOM события для взаимодействий с пользовательским интерфейсом

### Соображения производительности
- Система очистки шариков для предотвращения утечек памяти
- Эффективное обнаружение столкновений с оптимизированными свойствами тел
- Адаптивный дизайн, который адаптируется к возможностям устройства

### Мобильная оптимизация
- Элементы управления, дружественные к касаниям, и адаптивный макет
- Обработка изменения ориентации с сохранением состояния игры
- Адаптивные параметры физики для разных размеров экрана

## Общие шаблоны разработки

### Добавление новых игровых функций
1. Добавить параметры конфигурации в `config.js`
2. Создать или изменить соответствующий класс менеджера
3. Обновить инициализацию `PlinkoGame` при необходимости
4. Добавить элементы UI в `UIManager` если требуется
5. Интегрировать с системой событий `GameLogic`

### Изменение физического поведения
- Настроить параметры в `config.js` (упругость, трение, гравитация)
- Изменить обнаружение столкновений в `PhysicsManager`
- Обновить свойства колышков в `PyramidManager`

### Изменения стилей
- CSS модульный - каждый компонент имеет свой файл
- Основная координация стилей в `main.css`
- Адаптивный дизайн обрабатывается через JavaScript расчеты размеров